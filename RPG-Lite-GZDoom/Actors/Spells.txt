Actor SpellActive : Inventory
{          
  Inventory.Amount 1
  Inventory.MaxAmount 1
Inventory.InterHubAmount 0
  +INVENTORY.ALWAYSPICKUP
}

ACTOR SPBaseSpell : CustomInventory
{

  +INVENTORY.INVBAR
  +FLOATBOB
  +INVENTORY.ALWAYSPICKUP
  inventory.maxamount 5
  Inventory.InterHubAmount 1
  inventory.icon RADS_I
  Inventory.PickupMessage "Picked up Radiation Shield Upgrade" 
  States
  {
  Spawn:
    RADS A -1
    Stop
  Use:
	TNT1 A 0 A_JumpIfInventory("Mana",30,"ConfirmUse")
    TNT1 A 0 A_Print("Needs 30 mana")
	fail
  ConfirmUse:
	TNT1 A 0 A_GiveInventory("RadsuitEffect")
	TNT1 A 0 A_TakeInventory ("mana", 30)
	TNT1 A 0 A_Playsound("misc/p_pkup", CHAN_WEAPON)
	FAIL
  }
}

ACTOR RadsuitEffect : PowerupGiver
{
  +INVENTORY.AUTOACTIVATE
  +INVENTORY.ALWAYSPICKUP
  Inventory.MaxAmount 0
  Powerup.Type "IronFeet"
  Powerup.Duration -20

}

ACTOR SPInvis : SPBaseSpell
{

  +INVENTORY.INVBAR
  +FLOATBOB
  +INVENTORY.ALWAYSPICKUP
  inventory.maxamount 5
  Inventory.InterHubAmount 1
  inventory.icon PIN2_I
  Inventory.PickupMessage "Picked up Partial invisibility upgrade" 
  States
  {
  Spawn:
    PIN2 A -1
    Stop
  Use:
	TNT1 A 0 A_JumpIfInventory("Mana",40,"ConfirmUse")
    TNT1 A 0 A_Print("Needs 40 mana")
	fail
  ConfirmUse:
	TNT1 A 0 A_GiveInventory("PInvisEffect")
	TNT1 A 0 A_TakeInventory ("mana", 40)
	TNT1 A 0 A_Playsound("misc/p_pkup", CHAN_WEAPON)
	FAIL
  }
}

ACTOR PInvisEffect : PowerupGiver
{
  +INVENTORY.AUTOACTIVATE
  +INVENTORY.ALWAYSPICKUP
  Inventory.MaxAmount 0
  Powerup.Type "Invisibility"
  RenderStyle Translucent
  Powerup.Duration -20

}

ACTOR SPSpeed : SPBaseSpell
{

  +INVENTORY.INVBAR
  +FLOATBOB
  +INVENTORY.ALWAYSPICKUP
  inventory.maxamount 5
  Inventory.InterHubAmount 1
  inventory.icon SPDB_I
  Inventory.PickupMessage "Picked up Speed Upgrade" 
  States
  {
  Spawn:
    SPDB A -1
    Stop
  Use:
	TNT1 A 0 A_JumpIfInventory("Mana",30,"ConfirmUse")
    TNT1 A 0 A_Print("Needs 30 mana")
	fail
  ConfirmUse:
	TNT1 A 0 A_GiveInventory("SpeedEffect")
	TNT1 A 0 A_TakeInventory ("mana", 30)
	TNT1 A 0 A_Playsound("misc/p_pkup", CHAN_WEAPON)
	FAIL
  }
}

ACTOR SpeedEffect : PowerupGiver
{
  +INVENTORY.AUTOACTIVATE
  +INVENTORY.ALWAYSPICKUP
  Inventory.MaxAmount 0
  Powerup.Type "PowerSpeed"
  RenderStyle Translucent
  Powerup.Duration -20

}

ACTOR SPRage: SPBaseSpell
{

  +INVENTORY.INVBAR
  +FLOATBOB
  +INVENTORY.ALWAYSPICKUP
  inventory.maxamount 5
  Inventory.InterHubAmount 1
  inventory.icon RGSP_I
  Inventory.PickupMessage "Picked up Rage Upgrade" 
  States
  {
  Spawn:
    RGSP A -1
    Stop
  Use:
	TNT1 A 0 A_JumpIfInventory("Mana",60,"ConfirmUse")
    TNT1 A 0 A_Print("Needs 60 mana")
	fail
  ConfirmUse:
	TNT1 A 0 A_GiveInventory("RageEffect")
	TNT1 A 0 A_TakeInventory ("mana", 60)
	TNT1 A 0 A_Playsound("misc/p_pkup", CHAN_WEAPON)
	FAIL
  }
}

ACTOR RageEffect : PowerupGiver
{
  +INVENTORY.AUTOACTIVATE
  +INVENTORY.ALWAYSPICKUP
  Inventory.MaxAmount 0
  Powerup.Type "PowerDoubleFiringSpeed"
  RenderStyle Translucent
  Powerup.Duration -10

}

ACTOR SPAmmoSynth : CustomInventory
{
  +INVENTORY.INVBAR
  +FLOATBOB
  +INVENTORY.ALWAYSPICKUP
  inventory.maxamount 1
  Inventory.InterHubAmount 1
  inventory.icon ASSP_I
  Inventory.PickupMessage "Picked up Magic Ammo Synth" 
  States
  {
  Spawn:
    ASSP A -1 Bright
    Stop
  Use:
    TNT1 A 0 A_JumpIfInventory("Mana",30,"ConfirmUse")
    TNT1 A 0 A_Print("Needs 30 mana")
	fail
  ConfirmUse:
	TNT1 A 0 A_SpawnItemEx("AmmoSynthEffect",45,0,30,5)
	TNT1 A 0 A_TakeInventory("Mana",30)
	TNT1 A 0 A_Playsound("misc/p_pkup", CHAN_WEAPON)
	fail
  }
}

Actor AmmoSynthEffect : RandomSpawner 
{
  DropItem "Clip",256, 40
  DropItem "Shell",256, 40
  DropItem "Cell",256, 10
  DropItem "RocketAmmo",256, 10
  DropItem "ClipBox",256, 4
  DropItem "ShellBox",256, 4
  DropItem "CellPack",256, 1
  DropItem "RocketBox",256, 1
}

ACTOR SPLesserGuardian : CustomInventory
{
  +INVENTORY.INVBAR
  +FLOATBOB
  +INVENTORY.ALWAYSPICKUP
  inventory.maxamount 1
  Inventory.InterHubAmount 1
  inventory.icon GSSP_I
  Inventory.PickupMessage "Picked up Summon Lesser Guardian" 
  States
  {
  Spawn:
    GSSP A -1 Bright
    Stop
  Use:
    TNT1 A 0 A_JumpIfInventory("Mana",50,"ConfirmUse")
    TNT1 A 0 A_Print("Needs 50 mana")
	fail
  ConfirmUse:
	TNT1 A 0 A_SpawnItemEx("LesserGuardianEffect",45,0,30,5)
	TNT1 A 0 A_TakeInventory("Mana",50)
	TNT1 A 0 A_Playsound("misc/p_pkup", CHAN_WEAPON)
	fail
  }
}

ACTOR LesserGuardianEffect
{
	Health 100
	Radius 20
	Height 39
	Mass 1000
	Speed 0
	PainChance 200
	Monster
	+FLOATBOB
	+Friendly
	-Solid
	-CountKill
	States
	{
	Spawn:
		TNT1 A 0
		TNT1 A 1 ACS_NamedExecuteAlways("FriendlySummon",0,60)
	Spawn2:
		GSSP B 10 A_Look
		Loop
	See:
		GSSP B 3 A_Chase
		Loop
	Missile:
		GSSP B 8 A_FaceTarget
		GSSP BC 2
		GSSP D 2 A_CustomMissile("SummonedGuardianAttack")
		Goto See
	Pain:
		GSSP B 2
		GSSP B 2 A_Pain
		Goto See
	Death:
		BAL1 CDE 6 BRIGHT
		Stop
	}
}

ACTOR SPGuardian : CustomInventory
{
  +INVENTORY.INVBAR
  +FLOATBOB
  +INVENTORY.ALWAYSPICKUP
  inventory.maxamount 1
  Inventory.InterHubAmount 1
  inventory.icon GSSP_I2
  Inventory.PickupMessage "Picked up Summon Guardian" 
  States
  {
  Spawn:
    GSSP E -1 Bright
    Stop
  Use:
    TNT1 A 0 A_JumpIfInventory("Mana",80,"ConfirmUse")
    TNT1 A 0 A_Print("Needs 80 mana")
	fail
  ConfirmUse:
	TNT1 A 0 A_SpawnItemEx("GuardianEffect",45,0,0,5)
	TNT1 A 0 A_TakeInventory("Mana",80)
	TNT1 A 0 A_Playsound("misc/p_pkup", CHAN_WEAPON)
	fail
  }
}

ACTOR GuardianEffect
{
	Health 150
	Radius 20
	Height 39
	Mass 1000
	Speed 4
	PainChance 200
	Monster
	+FLOAT
	+FLOATBOB
	+NOGRAVITY
	+Friendly
	-CountKill
	-Solid
	States
	{
	Spawn:
		TNT1 A 0
		TNT1 A 1 ACS_NamedExecuteAlways("FriendlySummon",0,90)
	Spawn2:
		GSSP F 10 A_Look
		Loop
	See:
		GSSP F 3 A_Chase
		Loop
	Missile:
		GSSP F 8 A_FaceTarget
		GSSP FG 2
		GSSP HHH 5 A_CustomMissile("SummonedGuardianAttack")
		Goto See
	Pain:
		GSSP F 2
		GSSP F 2 A_Pain
		Goto See
	Death:
		BAL1 CDE 6 BRIGHT
		Stop
	}
}

Actor SummonedGuardianSmoke
{
	+NOBLOCKMAP
	+NOGRAVITY
	+SHADOW
	+NOTELEPORT
	+CANNOTPUSH
	+NODAMAGETHRUST
	RenderStyle "Translucent"
	Alpha 0.6
	States
	{
	Spawn:
		MSGA ABAB 4
		Stop
	}
}

Actor SummonedGuardianAttack : FastProjectile
{
  Speed 184
  Radius 12
  Height 8
  Damage 2
  +RIPPER
  +CANNOTPUSH
  +NODAMAGETHRUST
  +SPAWNSOUNDSOURCE
  MissileType "SummonedGuardianSmoke"
  //SeeSound "MageWandFire"
  States
  {
	Spawn:
		MSGA AB 4 Bright
		Loop
	Death:
		MSGA C 4 Bright
		MSGA D 3 Bright
		MSGA E 4 Bright
		MSGA F 3 Bright
		MSGA G 4 Bright
		Stop
  }
}

ACTOR SPPush : CustomInventory
{
  +INVENTORY.INVBAR
  +FLOATBOB
  +INVENTORY.ALWAYSPICKUP
  inventory.maxamount 5
  Inventory.InterHubAmount 1
  inventory.icon FPSP_I
  Inventory.PickupMessage "Picked up Push" 
  States
  {
  Spawn:
    FPSP A -1 Bright
    Stop
  Use:
    TNT1 A 0 A_JumpIfInventory("Mana",10,"ConfirmUse")
    TNT1 A 0 A_Print("Needs 10 mana")
	fail
  ConfirmUse:
	TNT1 A 0 A_Blast(BF_NOIMPACTDAMAGE)
	TNT1 A 0 A_TakeInventory("Mana",10)
	fail
  }
}